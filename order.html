<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Keranjang Belanja</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">

<div class="container py-5">
  <h3 class="mb-4">Keranjang Belanja</h3>
  <div id="cartItems"></div>
  <h4 class="mt-3">Total: <span id="cartTotal"></span></h4>

  <div class="mb-3">
    <label class="form-label fw-bold">Nama Pemesan</label>
    <input type="text" id="buyerName" class="form-control" placeholder="Nama Anda">
  </div>

  <div class="mb-3">
    <label class="form-label fw-bold">Metode Pembayaran</label>
    <select id="paymentMethod" class="form-select">
      <option value="Transfer">Transfer</option>
      <option value="COD">COD (Cash on Delivery)</option>
    </select>
  </div>

  <!-- Tempat nomor rekening muncul -->
  <div id="bankAccountInfo" class="mb-3 text-success fw-semibold" style="display:none;">
    Nomor Rekening: <br>
    185-687-5766 <br>
    Atas Nama: <br>
    NICKSON STEVI YIKWA
  </div>

    <p>Jika sudah melakukan pembayaran, segerah kirimkan bukti transfer kepada kami via WhatsApp!</p>
  <div class="mb-3">
    <label class="form-label fw-bold">Alamat pengiriman</label>
    <textarea id="address" class="form-control" placeholder="Masukkan alamat pengiriman"></textarea>
  </div>

  <div class="d-flex gap-2">
    <button id="clearCart" type="button" class="btn btn-outline-danger">Kosongkan Keranjang</button>
    <button id="waBtn" type="button" class="btn btn-success">Kirim via WhatsApp</button>
  </div>
</div>

<script>
  const WA_NUMBER = "6282155529051"; // Nomor WhatsApp tujuan tanpa tanda +

  function getCart() {
    return JSON.parse(localStorage.getItem("cart")) || [];
  }

  function saveCart(cart) {
    localStorage.setItem("cart", JSON.stringify(cart));
  }

  function renderCart() {
    const cart = getCart();
    const cartItemsEl = document.getElementById("cartItems");
    cartItemsEl.innerHTML = "";
    let total = 0;

    if (cart.length === 0) {
      cartItemsEl.innerHTML = "<p>Keranjang kosong</p>";
      document.getElementById("cartTotal").textContent = "Rp 0";
      return;
    }

    cart.forEach((item, index) => {
      const subtotal = item.qty * item.price;
      total += subtotal;

      cartItemsEl.innerHTML += `
        <div class="card mb-2 p-2">
          <div class="d-flex justify-content-between align-items-center">
            <div>
              <strong>${item.name}</strong><br />
              Rp ${item.price.toLocaleString("id-ID")} x
              <input type="number" class="qty-input" data-index="${index}" value="${item.qty}" min="1" style="width:60px" />
            </div>
            <div>
              Rp ${subtotal.toLocaleString("id-ID")}
              <button class="btn btn-sm btn-danger remove-item" data-index="${index}">Hapus</button>
            </div>
          </div>
        </div>
      `;
    });

    document.getElementById("cartTotal").textContent = "Rp " + total.toLocaleString("id-ID");
  }


  document.addEventListener("input", function(e) {
    if (e.target.classList.contains("qty-input")) {
      const index = e.target.dataset.index;
      let cart = getCart();
      cart[index].qty = Math.max(1, parseInt(e.target.value) || 1);
      saveCart(cart);
      renderCart();
    }
  });


  document.addEventListener("click", function(e) {
    if (e.target.classList.contains("remove-item")) {
      const index = e.target.dataset.index;
      let cart = getCart();
      cart.splice(index, 1);
      saveCart(cart);
      renderCart();
    }
  });


  document.getElementById("clearCart").addEventListener("click", () => {
    localStorage.removeItem("cart");
    renderCart();
  });

  // Tampilkan / sembunyikan nomor rekening saat metode pembayaran berubah
  const paymentMethodSelect = document.getElementById("paymentMethod");
  const bankAccountInfo = document.getElementById("bankAccountInfo");

  paymentMethodSelect.addEventListener("change", () => {
    if (paymentMethodSelect.value === "Transfer") {
      bankAccountInfo.style.display = "block";
    } else {
      bankAccountInfo.style.display = "none";
    }
  });

  // Inisialisasi tampilan nomor rekening sesuai pilihan awal
  if (paymentMethodSelect.value === "Transfer") {
    bankAccountInfo.style.display = "block";
  }

  function generateWhatsAppMessage(cart, buyerName, paymentMethod, address) {
    let msg = "Halo, saya ingin memesan produk berikut:\n";
    cart.forEach(item => {
      msg += `- ${item.name} (${item.qty}x) = Rp ${(item.qty * item.price).toLocaleString("id-ID")}\n`;
    });
    const total = cart.reduce((sum, i) => sum + (i.qty * i.price), 0);
    msg += `\nTotal Keseluruhan: Rp ${total.toLocaleString("id-ID")}\n\n`;
    msg += `Nama Pemesan: ${buyerName}\n`;
    msg += `Metode Pembayaran: ${paymentMethod}\n`;
    if(paymentMethod === "Transfer") {
      msg += `Nomor Rekening: BCA 123-456-7890 a.n. PT Contoh\n`;
    }
    msg += `Alamat: ${address}`;
    return encodeURIComponent(msg);
  }

  document.getElementById("waBtn").addEventListener("click", () => {
    const cart = getCart();
    const buyerName = document.getElementById("buyerName").value.trim() || "-";
    const paymentMethod = paymentMethodSelect.value;
    const address = document.getElementById("address").value.trim() || "-";

    if (cart.length === 0) {
      alert("Keranjang masih kosong. Silakan tambahkan produk terlebih dahulu.");
      return;
    }
    if (buyerName === "-") {
      alert("Mohon isi nama pemesan.");
      return;
    }
    if (address === "-") {
      alert("Mohon isi alamat pengiriman.");
      return;
    }

    const waMessage = generateWhatsAppMessage(cart, buyerName, paymentMethod, address);
    const waUrl = `https://wa.me/${WA_NUMBER}?text=${waMessage}`;
    window.open(waUrl, "_blank");

    // Jika ingin kosongkan keranjang setelah checkout, aktifkan baris berikut:
    // localStorage.removeItem("cart");
    // renderCart();
  });

  renderCart();
</script>

</body>
</html>
